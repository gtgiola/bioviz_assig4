<html>
	<head>
		<title>BioViz Assig4</title>
		<script src='http://d3js.org/d3.v3.min.js' charset='utf-8'></script>
	</head>
	<body>
		<div id="assig4">
			<h1>Biovisualization Assignment 4</h1>
			<h2>Greg Giola</h2>
		</div>
			<script>
				//DATA
				//var seq1 = "MSKVILKIKRLPHAQDLPLPSYATPHSSGLDLRAAIEKPLKIKPFERVLIPTGLILEIPEGYEGQVRPRSGLAWKKGLTVLNAPGTIDADYRGEVKVILVNLGNEEVVIERGERIAQLVIAPVQRVEVVEVEEVSQTQRGEGGFGSTGTK"; //DUT_ACQUAE
				//var seq2 = "MSTKVTVELQRLPHAEGLPLPAYQTAEAAGLDLMAAVPEDAPLTLASGRYALVPTGLAIALPPGHEAQVRPRSGLAAKHGVTVLNSPGTIDADYRGEIKVILINHGAAAFVIKRGERIAQMVIAPVVQAALVPVATLSATDRGAGGFGSTGR"; //DUT_BRAJA
				var seq1 = "GAATTCAGTTA"
				var seq2 = "GGATCGA"
				
				var svg = d3.select("body").append("svg")
					.attr("width", 1300)
					.attr("height", 400)
				var gapChar = "-";
				var matchChar = "|";
				var scoringMatrix = [];
				var pathMatrix = [];
				var matchScore = 2;
				var mismatchScore = -1;
				var gapScore = -2;
				// calculate the score matrix
				for (var i = 0; i <= seq1.length; i++) {
					var col = [];
					var pathCol = [];
					scoringMatrix.push(col);
					pathMatrix.push(pathCol);
					for (var j = 0; j <= seq2.length; j++) {
						var match = -Infinity, 
							gap1 = -Infinity,
							gap2 = -Infinity;
						// match/mismatch scores
						if (i > 0 && j > 0) {
							match = scoringMatrix[i-1][j-1] + (seq1[i-1] == seq2[j-1] ? matchScore : mismatchScore);
						}
						// gap scores
						if (i > 0) {
							gap1 = scoringMatrix[i-1][j] + gapScore;
						}
						if (j > 0) {
							gap2 = scoringMatrix[i][j-1] + gapScore;
						}
						if (i == 0 && j == 0) {
							match = 0;
						}
						var best = Math.max(match, gap1, gap2);
						col.push(best);
						// update the path that we have taken
						if (best == match && i > 0 && j > 0) {
							pathCol.push([1,1]);
						} else if (best == gap2 && j > 0) {
							pathCol.push([0,1]);
						} else if (i > 0) {
							pathCol.push([1,0]);
						} else {
							pathCol.push([0,0]);
						}
					}
				}
				var seq1out = "";
				var seq2out = "";
				var seqmatch = "";
				// backtrack to find sequence
				var i = seq1.length;
				var j = seq2.length;
				console.log("score = " + scoringMatrix[i][j]);
				while (i != 0 || j != 0) {
					var direction = pathMatrix[i][j];
					seq1out = (direction[0] ? seq1[i-1] : gapChar) + seq1out;
					seq2out = (direction[1] ? seq2[j-1] : gapChar) + seq2out;
					seqmatch = (direction[0] && direction[1] && seq1[i-1] == seq2[j-1] ? matchChar : " ") + seqmatch;
					i -= direction[0];
					j -= direction[1];
				}
				svg.append("text")
					.attr("x", 0)
					.attr("y", 100)
					.attr("font-size", "15px")
					.attr("font-family", "monospace")
					.text(seq1out);
				svg.append("text")
					.attr("x", 0)
					.attr("y", 125)
					.attr("font-size", "15px")
					.attr("font-family", "monospace")
					.attr("xml:space", "preserve")
					.text(seqmatch);
				svg.append("text")
					.attr("x", 0)
					.attr("y", 150)
					.attr("font-size", "15px")
					.attr("font-family", "monospace")
					.text(seq2out);
			</script>
	</body>
</html>